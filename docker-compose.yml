services:
  nginx:
    build:
      context: .
      dockerfile: Dockerfile.nginx
    ports:
      - 8081:80
    volumes:
      - ./nginx:/etc/nginx/conf.d
    restart: unless-stopped
    depends_on:
      - pronom
  pronom:
    build:
      context: .
      dockerfile: Dockerfile.flask
    image: pronom:latest
    environment:
      - ALLOW_INSECURE=true
      - RUNTIME=develop
    volumes:
      - ./pyproject.toml:/app/pyproject.toml
      - ./poetry.lock:/app/poetry.lock
      - ./app:/app/app
      - ./lambdas:/app/lambdas
    restart: unless-stopped
  dev:
    image: ghcr.io/nationalarchives/tna-python-dev:0
    volumes:
      - .:/app
